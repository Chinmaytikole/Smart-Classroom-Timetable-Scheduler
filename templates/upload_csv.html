{% extends "base.html" %}

{% block title %}Upload CSV - Intelligent Timetable System{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header Section -->
    <div class="header-section">
        <div class="header-content">
            <div>
                <h1 class="main-title">
                    <i class="fas fa-file-import title-icon"></i> CSV Data Import
                </h1>
                <p class="welcome-text">Bulk import data using CSV files for efficient management</p>
            </div>
            <a href="{{ url_for('dashboard') }}" class="action-btn">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
        <div class="header-glow"></div>
    </div>

    <div class="content-grid">
        <!-- Main Upload Card -->
        <div class="content-card">
            <div class="card-header" style="background: linear-gradient(135deg, var(--accent-green), #22c55e);">
                <h5 class="card-title" style="color: white;">
                    <i class="fas fa-upload card-icon"></i> Upload CSV File
                </h5>
            </div>
            <div class="card-content">
                <form method="POST" action="{{ url_for('upload_csv') }}" enctype="multipart/form-data">
                    <div class="mb-4">
                        <label for="data_type" class="form-label">Select Data Type</label>
                        <select class="form-select" id="data_type" name="data_type" required
                                style="background: var(--bg-secondary); border-color: var(--border-color); color: var(--text-primary);">
                            <option value="">Choose data type to import...</option>
                            <option value="departments">Departments</option>
                            <option value="subjects">Subjects</option>
                            <option value="faculty">Faculty</option>
                            <option value="classrooms">Classrooms</option>
                            <option value="batches">Batches</option>
                            <option value="faculty_subjects">Faculty Subjects Mapping</option>
                            <option value="faculty_leaves">Faculty Leave Information</option>
                            <option value="fixed_slots">Fixed Time Slots</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label for="csv_file" class="form-label">CSV File</label>
                        <input type="file" class="form-control" id="csv_file" name="csv_file" accept=".csv" required
                               style="background: var(--bg-secondary); border-color: var(--border-color); color: var(--text-primary);">
                        <div class="form-text" style="color: var(--text-muted);">Select a CSV file to upload. Maximum file size: 16MB</div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">CSV Format Guidelines</label>
                        <div class="alert" style="background: var(--bg-secondary); border-color: var(--border-color); color: var(--text-secondary);">
                            <h6><i class="fas fa-info-circle" style="color: var(--accent-blue);"></i> Required CSV Formats:</h6>
                            <ul class="mb-0">
                                <li><strong>Departments</strong>: code, name</li>
                                <li><strong>Subjects</strong>: code, name, department_id, subject_type, classes_per_week</li>
                                <li><strong>Faculty</strong>: employee_id, name, department_id, max_hours_per_day, preferred_times</li>
                                <li><strong>Classrooms</strong>: name, capacity, type, department_id</li>
                                <li><strong>Batches</strong>: name, department_id, semester, strength</li>
                                <li><strong>Faculty Subjects</strong>: faculty_id, subject_id</li>
                                <li><strong>Faculty Leaves</strong>: faculty_id, avg_leaves_per_month</li>
                                <li><strong>Fixed Slots</strong>: batch_id, day, time_slot, subject_id, faculty_id, classroom_id</li>
                            </ul>
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="action-btn action-green btn-lg">
                            <i class="fas fa-upload"></i> Upload and Process CSV
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Templates Card -->
        <div class="content-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-download card-icon"></i> Download Templates
                </h5>
            </div>
            <div class="card-content">
                <p style="color: var(--text-secondary);">Download CSV templates for each data type:</p>
                
                <div class="actions-grid">
                    <a href="{{ url_for('download_template', template_type='departments') }}" class="action-item action-blue">
                        <div class="action-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="action-text">Departments Template</div>
                        <div class="action-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                    <a href="{{ url_for('download_template', template_type='subjects') }}" class="action-item action-blue">
                        <div class="action-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="action-text">Subjects Template</div>
                        <div class="action-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                    <a href="{{ url_for('download_template', template_type='faculty') }}" class="action-item action-blue">
                        <div class="action-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="action-text">Faculty Template</div>
                        <div class="action-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                    <a href="{{ url_for('download_template', template_type='classrooms') }}" class="action-item action-blue">
                        <div class="action-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="action-text">Classrooms Template</div>
                        <div class="action-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                    <a href="{{ url_for('download_template', template_type='batches') }}" class="action-item action-blue">
                        <div class="action-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="action-text">Batches Template</div>
                        <div class="action-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                    <a href="{{ url_for('download_template', template_type='faculty_subjects') }}" class="action-item action-cyan">
                        <div class="action-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="action-text">Faculty Subjects Template</div>
                        <div class="action-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                    <a href="{{ url_for('download_template', template_type='faculty_leaves') }}" class="action-item action-cyan">
                        <div class="action-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="action-text">Faculty Leaves Template</div>
                        <div class="action-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                    <a href="{{ url_for('download_template', template_type='fixed_slots') }}" class="action-item action-cyan">
                        <div class="action-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="action-text">Fixed Slots Template</div>
                        <div class="action-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </a>
                </div>

                <div class="alert" style="background: var(--bg-secondary); border-color: var(--border-color); color: var(--text-secondary); margin-top: 1.5rem;">
                    <h6><i class="fas fa-exclamation-triangle" style="color: var(--accent-orange);"></i> Important Notes:</h6>
                    <ul class="mb-0">
                        <li>CSV files must have headers matching the templates</li>
                        <li>Use IDs for relationships (department_id, faculty_id, etc.)</li>
                        <li>File encoding should be UTF-8</li>
                        <li>Backup your data before bulk imports</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload History -->
    <div class="content-card" style="margin-top: 2rem;">
        <div class="card-header">
            <h5 class="card-title">
                <i class="fas fa-history card-icon"></i> Recent Uploads
            </h5>
        </div>
        <div class="card-content">
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <h4>Upload History Coming Soon</h4>
                <p>This feature is currently under development and will be available soon.</p>
            </div>
        </div>
    </div>
</div>

<style>
/* Form control styling */
.form-control, .form-select {
    background: var(--bg-secondary) !important;
    border: 1px solid var(--border-color) !important;
    color: var(--text-primary) !important;
}

.form-control:focus, .form-select:focus {
    border-color: var(--accent-blue) !important;
    box-shadow: 0 0 0 0.2rem rgba(0, 212, 255, 0.25) !important;
}

.form-label {
    color: var(--text-secondary);
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.form-text {
    color: var(--text-muted) !important;
    font-size: 0.875rem;
}

/* Alert styling */
.alert {
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
}

/* Content grid for two-column layout */
.content-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    margin-top: 2rem;
}

@media (max-width: 1024px) {
    .content-grid {
        grid-template-columns: 1fr;
    }
}

/* List styling */
ul {
    color: var(--text-secondary);
    padding-left: 1.5rem;
}

ul li {
    margin-bottom: 0.25rem;
}

/* File input styling */
input[type="file"]::file-selector-button {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    padding: 0.5rem 1rem;
    border-radius: 4px;
    margin-right: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

input[type="file"]::file-selector-button:hover {
    background: var(--bg-hover);
    border-color: var(--border-hover);
}
</style>

{% block scripts %}
<script>
// Add hover effects to action items
document.addEventListener('DOMContentLoaded', function() {
    const actionItems = document.querySelectorAll('.action-item');
    actionItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });
        item.addEventListener('mouseleave', function() {
            this.style.transform = '';
        });
    });
});

// File input enhancement
document.getElementById('csv_file').addEventListener('change', function(e) {
    const fileName = e.target.files[0]?.name;
    if (fileName) {
        const label = this.previousElementSibling;
        label.textContent = `CSV File: ${fileName}`;
    }
});
</script>
{% endblock %}
{% endblock %}