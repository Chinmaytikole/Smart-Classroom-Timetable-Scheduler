@app.route('/debug/timetable/<int:timetable_id>')
@admin_required
def debug_timetable(timetable_id):
    """Debug route to see raw timetable data"""
    conn = sqlite3.connect('timetable.db')
    conn.row_factory = sqlite3.Row
    cursor = conn.cursor()
    
    # Get timetable info
    cursor.execute('SELECT * FROM timetables WHERE id = ?', (timetable_id,))
    timetable = cursor.fetchone()
    
    # Get all slots
    cursor.execute('''
        SELECT ts.*, s.name as subject_name, f.name as faculty_name, 
               c.name as classroom_name, b.name as batch_name
        FROM timetable_slots ts
        LEFT JOIN subjects s ON ts.subject_id = s.id
        LEFT JOIN faculty f ON ts.faculty_id = f.id
        LEFT JOIN classrooms c ON ts.classroom_id = c.id
        LEFT JOIN batches b ON ts.batch_id = b.id
        WHERE ts.timetable_id = ?
        ORDER BY ts.batch_id, ts.day, ts.time_slot
    ''', (timetable_id,))
    
    slots = cursor.fetchall()
    
    conn.close()
    
    # Create HTML response with raw data
    html = f"""
    <h1>Debug: Timetable {timetable_id}</h1>
    <h3>Timetable Info:</h3>
    <pre>{dict(timetable) if timetable else 'No timetable found'}</pre>
    
    <h3>Slots ({len(slots)} found):</h3>
    <table border="1">
        <tr>
            <th>ID</th>
            <th>Batch</th>
            <th>Day</th>
            <th>Time</th>
            <th>Subject</th>
            <th>Faculty</th>
            <th>Classroom</th>
        </tr>
    """
    
    for slot in slots:
        html += f"""
        <tr>
            <td>{slot['id']}</td>
            <td>{slot['batch_id']} ({slot['batch_name']})</td>
            <td>{slot['day']}</td>
            <td>{slot['time_slot']}</td>
            <td>{slot['subject_id']} ({slot['subject_name']})</td>
            <td>{slot['faculty_id']} ({slot['faculty_name']})</td>
            <td>{slot['classroom_id']} ({slot['classroom_name']})</td>
        </tr>
        """
    
    html += "</table>"
    return html